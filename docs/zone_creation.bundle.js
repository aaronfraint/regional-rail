(()=>{"use strict";var e=function(){return e=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var a in t=arguments[o])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},e.apply(this,arguments)},t={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",animation:"spinner-line-fade-default",rotate:0,direction:1,speed:1,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"0 0 1px transparent",position:"absolute"},o=function(){function o(o){void 0===o&&(o={}),this.opts=e(e({},t),o)}return o.prototype.spin=function(e){return this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),n(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")"}),e&&e.insertBefore(this.el,e.firstChild||null),function(e,t){var o=Math.round(t.corners*t.width*500)/1e3+"px",i="none";!0===t.shadow?i="0 2px 4px #000":"string"==typeof t.shadow&&(i=t.shadow);for(var l=function(e){for(var t=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,o=[],n=0,a=e.split(",");n<a.length;n++){var s=a[n].match(t);if(null!==s){var i=+s[2],l=+s[5],r=s[4],c=s[7];0!==i||r||(r=c),0!==l||c||(c=r),r===c&&o.push({prefix:s[1]||"",x:i,y:l,xUnits:r,yUnits:c,end:s[8]})}}return o}(i),r=0;r<t.lines;r++){var c=~~(360/t.lines*r+t.rotate),p=n(document.createElement("div"),{position:"absolute",top:-t.width/2+"px",width:t.length+t.width+"px",height:t.width+"px",background:a(t.fadeColor,r),borderRadius:o,transformOrigin:"left",transform:"rotate("+c+"deg) translateX("+t.radius+"px)"}),d=r*t.direction/t.lines/t.speed;d-=1/t.speed;var u=n(document.createElement("div"),{width:"100%",height:"100%",background:a(t.color,r),borderRadius:o,boxShadow:s(l,c),animation:1/t.speed+"s linear "+d+"s infinite "+t.animation});p.appendChild(u),e.appendChild(p)}}(this.el,this.opts),this},o.prototype.stop=function(){return this.el&&("undefined"!=typeof requestAnimationFrame?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},o}();function n(e,t){for(var o in t)e.style[o]=t[o];return e}function a(e,t){return"string"==typeof e?e:e[t%e.length]}function s(e,t){for(var o=[],n=0,a=e;n<a.length;n++){var s=a[n],l=i(s.x,s.y,t);o.push(s.prefix+l[0]+s.xUnits+" "+l[1]+s.yUnits+s.end)}return o.join(", ")}function i(e,t,o){var n=o*Math.PI/180,a=Math.sin(n),s=Math.cos(n);return[Math.round(1e3*(e*s+t*a))/1e3,Math.round(1e3*(-e*a+t*s))/1e3]}const l={lines:13,length:38,width:17,radius:45,scale:1,corners:1,speed:1,rotate:0,animation:"spinner-line-fade-quick",direction:1,color:"#ffffff",fadeColor:"transparent",top:"50%",left:"50%",shadow:"0 0 1px transparent",zIndex:2e9,className:"spinner",position:"absolute"},r=()=>{var e=document.getElementById("spinner");return new o(l).spin(e)};let c=[];const p=()=>{c=[]},d=e=>{["selected-taz","selected-taz-outline"].forEach((t=>{e.setFilter(t,["in","tazt",...c])}))},u=document.getElementById("button-to-select-tazs"),h=document.getElementById("button-to-clear-tazs"),f=document.getElementById("button-to-save-tazs"),m=document.getElementById("input-zone-name"),y=document.getElementById("get-started"),g=document.getElementById("save-zone"),z=e=>"inline"==e.style.display,v=e=>{e.style.setProperty("display","none")},w=e=>{e.style.setProperty("display","inline")},b="http://localhost:8000/api/regional-model",x=b+"/zone-geoms";const E=async function(e,t){let o=await async function(e){let t=!1;return await fetch("http://localhost:8000/api/regional-model/zone-names",{method:"GET",headers:{"Access-Control-Allow-Origin":"*"}}).then((e=>e.json())).then((o=>{o.forEach((o=>{o.zone_name==e&&(t=!0)}))})).catch((e=>{console.error("Error:",e)})),t}(t.zone_name);if(o)alert("The zone name '"+t.zone_name+"' already exists, please use a different one!"),m.value="",m.focus();else{let o=r();fetch("http://localhost:8000/api/regional-model/new-taz-group",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(t)}).then((e=>e.json())).then((t=>{o.stop(),(e=>{let t=r();fetch(x,{method:"GET",headers:{"Access-Control-Allow-Origin":"*"}}).then((e=>e.json())).then((o=>{e.getSource("zones-geojson").setData(o),t.stop()})).catch((e=>{console.error("Error:",e)}))})(e),p(),d(e),v(g),w(y)})).catch((e=>{console.error("Error:",e)}))}},j={"taz-tiles":{type:"vector",url:"https://www.tiles.dvrpc.org/data/taz-2010.json",minzoom:8},"zones-geojson":{type:"geojson",data:x},"rr-lines-src":{type:"geojson",data:"https://opendata.arcgis.com/datasets/48b0b600abaa4ca1a1bacf917a31c29a_0.geojson"},"rr-stops-src":{type:"geojson",data:"https://opendata.arcgis.com/datasets/64eaa4539cf4429095c2c7bf25c629a2_0.geojson"}};mapboxgl.accessToken="pk.eyJ1IjoiYWFyb25kdnJwYyIsImEiOiJja2NvN2s5dnAwaWR2MnptbzFwYmd2czVvIn0.Fcc34gzGME_zHR5q4RnSOg";const I={"taz-fill":{id:"taz-fill",type:"fill",source:"taz-tiles","source-layer":"TAZ_2010",layout:{},paint:{"fill-opacity":0,"fill-color":"black"}},"taz-outline":{id:"taz-outline",type:"line",source:"taz-tiles","source-layer":"TAZ_2010",layout:{},paint:{"line-width":.8,"line-opacity":.2,"line-color":"black"}},"selected-taz":{id:"selected-taz",type:"fill",source:"taz-tiles","source-layer":"TAZ_2010",layout:{},paint:{"fill-opacity":.5,"fill-color":"yellow"},filter:["==","tazt","-1"]},"selected-taz-outline":{id:"selected-taz-outline",type:"line",source:"taz-tiles","source-layer":"TAZ_2010",layout:{},paint:{"line-opacity":.8,"line-color":"black","line-width":2},filter:["==","tazt","-1"]},"zones-fill":{id:"zones-fill",type:"fill",source:"zones-geojson",layout:{},paint:{"fill-opacity":.1,"fill-color":"red"}},zones:{id:"zones",type:"line",source:"zones-geojson",layout:{},paint:{"line-opacity":.7,"line-color":"red","line-width":4}},"rr-lines":{id:"rr-lines",type:"line",source:"rr-lines-src",layout:{},paint:{"line-width":2,"line-opacity":1,"line-color":"black"}},"rr-stops":{id:"rr-stops",type:"circle",source:"rr-stops-src",layout:{},paint:{"circle-radius":4,"circle-opacity":.7,"circle-color":"black"}}},A=(e,t,o)=>{new mapboxgl.Popup({closeButton:!1,className:"i-am-a-popup"}).setLngLat(o.lngLat).setHTML(t).addTo(e)},k=()=>{var e=document.getElementsByClassName("mapboxgl-popup");e.length&&e[0].remove()},C=e=>{["taz-fill"].forEach((t=>((e,t)=>{e.on("mouseenter",t,(()=>{z(g)&&(e.getCanvas().style.cursor="pointer")})),e.on("mouseleave",t,(function(t){e.getCanvas().style.cursor=""}))})(e,t))),(e=>{e.on("mousemove","zones-fill",(t=>{k();let o="<h3>"+t.features[0].properties.zone_name+"</h3>";A(e,o,t)})),e.on("mouseleave","zones-fill",(()=>{k()}))})(e)},T=e=>{(e=>{u.onclick=()=>{w(g),v(y)},h.onclick=()=>{v(g),w(y),p(),d(e)},f.onclick=()=>{let t={zone_name:m.value,tazt:c};console.log(t),E(e,t)}})(e),(e=>{e.on("click","taz-fill",(function(t){if(z(g)){let o=t.features[0].properties.tazt,n=c.indexOf(o);-1!==n?c.splice(n,1):c.push(o),d(e)}}))})(e)},O=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v10",center:[-75.16362,39.95238],zoom:9.5});O.on("load",(function(){for(const e in j)O.addSource(e,j[e]);for(const e in I)O.addLayer(I[e]);C(O),T(O)}))})();